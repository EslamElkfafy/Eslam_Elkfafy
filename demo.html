<!DOCTYPE html>
<html>
<head>
  <title>Modal Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assets/theme.css">
  <link rel="stylesheet" href="assets/product-modal.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
    }
    
    .test-button {
      background-color: #000;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Product Modal Demo</h1>
  <p>Click the button below to open the modal:</p>
  <button class="test-button" onclick="openProductModal('Test Product')">Open Modal</button>
  
  <!-- Product Modal -->
  <div class="product-modal-overlay" id="product-modal-overlay" style="display: none;">
    <div class="product-modal-container">
      <!-- Close button -->
      <button class="product-modal-close" onclick="closeProductModal()" aria-label="Close product modal">
        <svg width="12" height="12" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5.03754 4.94355L13.5228 13.4288" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
          <path d="M5.03754 13.4285L13.5228 4.94324" stroke="black" stroke-width="1.5" stroke-linecap="square" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- Product Image -->
      <div class="product-modal-image-container">
        <img id="product-modal-image" src="" alt="Product" class="product-modal-image" width="120" height="140">
      </div>

      <!-- Product Title -->
      <div class="product-modal-title-container">
        <span class="product-modal-title" id="product-modal-title"></span>
      </div>

      <!-- Product Price -->
      <div class="product-modal-price-container">
        <span class="product-modal-price" id="product-modal-price"></span>
      </div>

      <!-- Product Description -->
      <div class="product-modal-description-container">
        <span class="product-modal-description" id="product-modal-description"></span>
      </div>

      <!-- Color Selection -->
      <div class="product-modal-color-container" id="color-options"></div>

      <!-- Size Selection -->
      <div class="product-modal-size-container">
        <div class="product-modal-size-label">
          <span class="product-modal-size-label-text">Size</span>
        </div>
        <div class="product-modal-size-dropdown">
          <button class="product-modal-size-button" id="size-dropdown-btn">
            <span class="product-modal-size-text" id="selected-size">Select size</span>
            <span>â–¼</span>
          </button>
          <div class="product-modal-size-dropdown-menu" id="size-options" style="display: none;"></div>
        </div>
      </div>

      <!-- Add to Cart Button -->
      <div class="product-modal-cart-container">
        <button class="product-modal-cart-button" onclick="addToCart()">
          <span class="product-modal-cart-text">Add to cart</span>
          <svg width="34" height="12" viewBox="0 0 36 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.40933 5.25L0.659332 5.25L0.659332 6.75L1.40933 6.75L1.40933 6L1.40933 5.25ZM35.6391 6.53033C35.932 6.23744 35.932 5.76257 35.6391 5.46967L30.8662 0.696701C30.5733 0.403808 30.0984 0.403808 29.8055 0.696701C29.5126 0.989594 29.5126 1.46447 29.8055 1.75736L34.0482 6L29.8055 10.2426C29.5126 10.5355 29.5126 11.0104 29.8055 11.3033C30.0984 11.5962 30.5733 11.5962 30.8662 11.3033L35.6391 6.53033ZM1.40933 6L1.40933 6.75L35.1088 6.75L35.1088 6L35.1088 5.25L1.40933 5.25L1.40933 6Z" fill="white"/>
          </svg>
        </button>
      </div>

      <!-- Hidden input for selected variant -->
      <input type="hidden" id="selected-variant-id" value="">
    </div>
  </div>

  <script>
    let currentProduct = null;
    let selectedColor = null;
    let selectedSize = null;

    function titleToHandle(title) {
      return title
        .trim()
        .toLowerCase()
        .replace(/[^a-z0-9\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-');
    }

    async function openProductModal(title) {
      // For demo purposes, we'll create a mock product object
      const product = {
        title: "Test Product",
        body_html: "This is a test product description.",
        image: {
          src: "https://placehold.co/120x140"
        },
        variants: [
          {
            id: 1,
            price: "29.99",
            price_currency: "USD",
            option1: "Small",
            option2: "White"
          },
          {
            id: 2,
            price: "29.99",
            price_currency: "USD",
            option1: "Medium",
            option2: "White"
          },
          {
            id: 3,
            price: "29.99",
            price_currency: "USD",
            option1: "Large",
            option2: "White"
          },
          {
            id: 4,
            price: "34.99",
            price_currency: "USD",
            option1: "Small",
            option2: "Blue"
          },
          {
            id: 5,
            price: "34.99",
            price_currency: "USD",
            option1: "Medium",
            option2: "Blue"
          },
          {
            id: 6,
            price: "34.99",
            price_currency: "USD",
            option1: "Large",
            option2: "Blue"
          }
        ],
        options: [
          {
            name: "Size",
            values: ["Small", "Medium", "Large"]
          },
          {
            name: "Color",
            values: ["White", "Blue"]
          }
        ]
      };
      
      currentProduct = product;

      // Fill basic info
      document.getElementById("product-modal-title").textContent = product.title;
      document.getElementById("product-modal-description").innerHTML = product.body_html;
      document.getElementById("product-modal-image").src = product.image?.src || "";
      document.getElementById("product-modal-image").alt = product.title;

      // Price = first variant
      document.getElementById("product-modal-price").textContent = `$${product.variants[0].price} ${product.variants[0].price_currency}`;
      document.getElementById("selected-variant-id").value = product.variants[0].id;

      // Build color buttons
      const colorContainer = document.getElementById("color-options");
      colorContainer.innerHTML = `
        <div class="product-modal-color-label">
          <span class="product-modal-color-label-text">Color</span>
        </div>
        <div class="product-modal-color-buttons">
          ${product.options.find(o => o.name === "Color").values.map((color, i) => `
            <button 
              class="product-modal-color-button ${color.toLowerCase()} ${i===0 ? 'selected':''}" 
              onclick="selectColor('${color}')"
              style="left: ${i * 136}px;">
              ${color}
            </button>
          `).join("")}
        </div>
      `;
      selectedColor = product.options.find(o => o.name === "Color").values[0];

      // Build size dropdown
      const sizeMenu = document.getElementById("size-options");
      sizeMenu.innerHTML = product.options.find(o => o.name === "Size").values.map(size => `
        <button class="product-modal-size-option" onclick="selectSize('${size}')">${size}</button>
      `).join("");
      selectedSize = null;
      document.getElementById("selected-size").textContent = "Select size";

      // Toggle size dropdown
      document.getElementById("size-dropdown-btn").onclick = () => {
        sizeMenu.style.display = sizeMenu.style.display === "block" ? "none" : "block";
      };

      document.getElementById("product-modal-overlay").style.display = "flex";
    }

    function selectColor(color) {
      selectedColor = color;
      document.querySelectorAll(".product-modal-color-button").forEach(btn => {
        btn.classList.toggle("selected", btn.textContent === color);
      });
      updateVariant();
    }

    function selectSize(size) {
      selectedSize = size;
      document.getElementById("selected-size").textContent = size;
      document.getElementById("size-options").style.display = "none";
      updateVariant();
    }

    function updateVariant() {
      if (!selectedColor || !selectedSize) return;

      // In Shopify, option1 is typically the first option (Size) and option2 is the second option (Color)
      const variant = currentProduct.variants.find(v =>
        v.option1 === selectedSize && v.option2 === selectedColor
      );

      if (variant) {
        document.getElementById("product-modal-price").textContent = `$${variant.price} ${variant.price_currency}`;
        document.getElementById("selected-variant-id").value = variant.id;
      }
    }

    async function addToCart() {
      const variantId = document.getElementById("selected-variant-id").value;
      if (!variantId) return;

      // For demo purposes, we'll just show an alert
      alert("Added to cart!");
      closeProductModal();
    }

    function closeProductModal() {
      document.getElementById("product-modal-overlay").style.display = "none";
    }
  </script>
</body>
</html>
